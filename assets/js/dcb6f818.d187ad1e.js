(self.webpackChunkuniswap=self.webpackChunkuniswap||[]).push([[5247],{3424:function(e,t,i){"use strict";i.r(t),i.d(t,{frontMatter:function(){return o},contentTitle:function(){return s},metadata:function(){return d},toc:function(){return l},default:function(){return c}});var n=i(2122),a=i(9756),r=(i(7294),i(3905)),o={id:"pool-liquidity",title:"Pool Liquidity"},s="Formalized Model",d={unversionedId:"guides/pool-liquidity",id:"version-V1/guides/pool-liquidity",isDocsHomePage:!1,title:"Pool Liquidity",description:"Uniswap liquidity pools are autonomous and use the Constant Product Market Maker \\(x * y = k\\). This model was formalized and the smart contract implementation passed a lightweight formal verification.",source:"@site/versioned_docs/version-V1/guides/02-pool-liquidity.md",sourceDirName:"guides",slug:"/guides/pool-liquidity",permalink:"/protocol/V1/guides/pool-liquidity",editUrl:"https://github.com/uniswap/uniswap-docs/tree/main/versioned_docs/version-V1/guides/02-pool-liquidity.md",version:"V1",sidebarPosition:2,frontMatter:{id:"pool-liquidity",title:"Pool Liquidity"},sidebar:"version-V1/mySidebar",previous:{title:"Connect to Uniswap",permalink:"/protocol/V1/guides/connect-to-uniswap"},next:{title:"Trade Tokens",permalink:"/protocol/V1/guides/trade-tokens"}},l=[{value:"Create Exchange",id:"create-exchange",children:[]},{value:"Exchange Reserves",id:"exchange-reserves",children:[{value:"ETH Reserve",id:"eth-reserve",children:[]},{value:"ERC20 Reserve",id:"erc20-reserve",children:[]}]},{value:"Add Liquidity",id:"add-liquidity",children:[{value:"Parameters",id:"parameters",children:[]}]},{value:"Remove Liquidity",id:"remove-liquidity",children:[{value:"Parameters",id:"parameters-1",children:[]}]}],u={toc:l};function c(e){var t=e.components,i=(0,a.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,n.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"formalized-model"},"Formalized Model"),(0,r.kt)("p",null,"Uniswap liquidity pools are autonomous and use the Constant Product Market Maker ","(",(0,r.kt)("inlineCode",{parentName:"p"},"x * y = k"),")",". This model was formalized and the smart contract implementation passed a lightweight formal verification."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/runtimeverification/verified-smart-contracts/blob/uniswap/uniswap/x-y-k.pdf"},"Formalized Specification")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/runtimeverification/verified-smart-contracts/tree/uniswap/uniswap/results"},"Lightweight Verification"))),(0,r.kt)("h2",{id:"create-exchange"},"Create Exchange"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"createExchange")," function is used to deploy exchange contracts for ERC20 tokens that do not yet have one."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"factory.methods.createExchange(tokenAddress).send();\n")),(0,r.kt)("p",null,"Once an exchange is created the address can be retrieved with ",(0,r.kt)("a",{parentName:"p",href:"connect-to-uniswap/#get-exchange-address"},(0,r.kt)("inlineCode",{parentName:"a"},"getExchange")),"."),(0,r.kt)("h2",{id:"exchange-reserves"},"Exchange Reserves"),(0,r.kt)("p",null,"Each exchange contract holds a liquidity reserve of ETH and its associated ERC20 token."),(0,r.kt)("h3",{id:"eth-reserve"},"ETH Reserve"),(0,r.kt)("p",null,"The ETH reserve associated with an ERC20 token exchange is the ETH balance of the exchange smart contract."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const ethReserve = web3.eth.getBalance(exchangeAddress);\n")),(0,r.kt)("h3",{id:"erc20-reserve"},"ERC20 Reserve"),(0,r.kt)("p",null,"The ERC20 reserve associated with an ERC20 token exchange is the ERC20 balance of the exchange smart contract."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const tokenReserve = tokenContract.methods.balanceOf(exchangeAddress);\n")),(0,r.kt)("h2",{id:"add-liquidity"},"Add Liquidity"),(0,r.kt)("p",null,"Anyone who wants can join a Uniswap liquidity pool by calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"addLiquidity")," function."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"exchange.methods\n  .addLiquidity(min_liquidity, max_tokens, deadline)\n  .send({ value: ethAmount });\n")),(0,r.kt)("p",null,"Adding liquidity requires depositing an equivalent ",(0,r.kt)("strong",{parentName:"p"},"value")," of ETH and ERC20 tokens into the ERC20 token's associated exchange contract."),(0,r.kt)("p",null,"The first liquidity provider to join a pool sets the initial exchange rate by depositing what they believe to be an equivalent value of ETH and ERC20 tokens. If this ratio is off, arbitrage traders will bring the prices to equilibrium at the expense of the initial liquidity provider."),(0,r.kt)("p",null,"All future liquidity providers deposit ETH and ERC20's using the exchange rate at the moment of their deposit. If the exchange rate is bad there is a profitable arbitrage opportunity that will correct the price."),(0,r.kt)("h3",{id:"parameters"},"Parameters"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"ethAmount")," sent to ",(0,r.kt)("inlineCode",{parentName:"p"},"addLiquidity")," is the exact amount of ETH that will be deposited into the liquidity reserves. It should be 50% of the total value a liquidity provider wishes to deposit into the reserves."),(0,r.kt)("p",null,"Since liquidity providers must deposit at the current exchange rate, the Uniswap smart contracts use ",(0,r.kt)("inlineCode",{parentName:"p"},"ethAmount")," to determine the amount of ERC20 tokens that must be deposited. This token amount is the remaining 50% of total value a liquidity provider wishes to deposit. Since exchange rate can change between when a transaction is signed and when it is executed on Ethereum, ",(0,r.kt)("inlineCode",{parentName:"p"},"max_tokens")," is used to bound the amount this rate can fluctuate. For the first liquidity provider, ",(0,r.kt)("inlineCode",{parentName:"p"},"max_tokens")," is the exact amount of tokens deposited."),(0,r.kt)("p",null,"Liquidity tokens are minted to track the relative proportion of total reserves that each liquidity provider has contributed. ",(0,r.kt)("inlineCode",{parentName:"p"},"min_liquidity")," is used in combination with ",(0,r.kt)("inlineCode",{parentName:"p"},"max_tokens")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"ethAmount")," to bound the rate at which liquidity tokens are minted. For the first liquidity provider, ",(0,r.kt)("inlineCode",{parentName:"p"},"min_liquidity")," does not do anything and can be set to 0."),(0,r.kt)("p",null,"Transaction ",(0,r.kt)("inlineCode",{parentName:"p"},"deadline"),' is used to set a time after which a transaction can no longer be executed. This limits the "free option" problem, where Ethereum miners can hold signed transactions and execute them based off market movements.'),(0,r.kt)("h2",{id:"remove-liquidity"},"Remove Liquidity"),(0,r.kt)("p",null,"Liquidity providers use the ",(0,r.kt)("inlineCode",{parentName:"p"},"removeLiquidity")," function to withdraw their portion of the reserves."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"exchange.methods.removeLiquidity(amount, min_eth, min_tokens, deadline).send();\n")),(0,r.kt)("p",null,"Liquidity is withdrawn at the same ratio as the reserves at the time of withdrawal. If the exchange rate is bad there is a profitable arbitrage opportunity that will correct the price."),(0,r.kt)("h3",{id:"parameters-1"},"Parameters"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"amount")," specifies the number of liquidity tokens that will be burned. Dividing this amount by the total liquidity token supply gives the percentage of both the ETH and ER20 reserves the provider is withdrawing."),(0,r.kt)("p",null,"Since exchange rate can change between when a transaction is signed and when it is executed on Ethereum, ",(0,r.kt)("inlineCode",{parentName:"p"},"min_eth")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"min_tokens")," are used to bound the amount this rate can fluctuate."),(0,r.kt)("p",null,"Same as in ",(0,r.kt)("inlineCode",{parentName:"p"},"addLiquidity"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"deadline")," is used to set a time after which a transaction can no longer be executed."))}c.isMDXComponent=!0},3905:function(e,t,i){"use strict";i.d(t,{Zo:function(){return u},kt:function(){return h}});var n=i(7294);function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function r(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){a(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function s(e,t){if(null==e)return{};var i,n,a=function(e,t){if(null==e)return{};var i,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||(a[i]=e[i]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(a[i]=e[i])}return a}var d=n.createContext({}),l=function(e){var t=n.useContext(d),i=t;return e&&(i="function"==typeof e?e(t):o(o({},t),e)),i},u=function(e){var t=l(e.components);return n.createElement(d.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var i=e.components,a=e.mdxType,r=e.originalType,d=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=l(i),h=a,m=p["".concat(d,".").concat(h)]||p[h]||c[h]||r;return i?n.createElement(m,o(o({ref:t},u),{},{components:i})):n.createElement(m,o({ref:t},u))}));function h(e,t){var i=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=i.length,o=new Array(r);o[0]=p;var s={};for(var d in t)hasOwnProperty.call(t,d)&&(s[d]=t[d]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var l=2;l<r;l++)o[l]=i[l];return n.createElement.apply(null,o)}return n.createElement.apply(null,i)}p.displayName="MDXCreateElement"}}]);